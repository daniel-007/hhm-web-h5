!function(){function e(e,r,t){$.ajax({type:"POST",url:e,data:r,timeout:15e3,success:function(e,r,i){e.status?t(null,e):t(e.msg,null)},error:function(r,i,s){console.error(e+" error: "+i+"##"+s),t("服务异常",null)}})}require.config({baseUrl:"../js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils.min"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(r,t){"use strict";r.config.delimiters=["${","}"],r.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-address-select",function(i,s,c){var d=t.getSearch(location),a=0;d.id&&(a=parseInt(d.id));var o=new r({el:"#page-address-select",data:{receivers:[],productIdStr:d.product}});e("/address/get-all-receiver",{},function(e,r){if(e)$.toast(e,1e3);else for(var t=r.receiver,i=t.length,s=0;i>s;s++){var c={};c.receiverId=t[s].SysNo,c.phone=t[s].ReceiverMobile,c.receiver=t[s].ReceiverName,c.pcdDes=t[s].Province+" "+t[s].City+" "+t[s].District+" "+t[s].Street,c.address=t[s].Address,c.isDefault=t[s].IsDefault,c.isSelected=c.receiverId===a,o.receivers.push(c)}})}),$(document).on("pageInit","#page-address-edit",function(i,s,c){function d(){$("#street-picker").picker({toolbarTemplate:'<header class="bar bar-nav"><button class="button button-link pull-right close-picker">              确定</button><h1 class="title">选择街道</h1></header>',onClose:o,cols:[{textAlign:"center",values:l.streetPicker}]})}function a(){var e=l.pcdDes.split(" "),r=t.getPCD(e[0],e[1],e[2]);l.pcdCode.splice(0,l.pcdCode.length),l.pcdName.splice(0,l.pcdName.length),l.pcdCode.push(r.province.id),l.pcdCode.push(r.city.id),l.pcdCode.push(r.district.id),l.pcdName.push(e[0]),l.pcdName.push(e[1]),l.pcdName.push(e[2]),n(r.district.id,function(){l.street=l.streetPicker[0],d()})}function o(){for(var e=0;e<l.streetList.length;e++){var r=l.streetList[e];if(r.Name===l.street)return void(l.streetId=r.SysNo)}}function n(r,t){e("/address/get-street",{districtId:r},function(e,r){if($.hidePreloader(),e)$.toast(e,1e3),t(e);else{l.streetList=r.street.slice(),l.streetPicker.splice(0,l.streetPicker.length);for(var i=0;i<l.streetList.length;i++)l.streetPicker.push(l.streetList[i].Name);t(null)}}),$.showPreloader("请稍等")}var l=void 0;if("/address/modify"===location.pathname){var p=t.getSearch(location);if(!p.id)return void(location.pathname="/");var u=parseInt(p.id);e("/address/get-all-receiver",{receiverId:u},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):(l=new r({el:"#page-address-edit",data:{receiverId:t.receiver.SysNo,phone:t.receiver.ReceiverMobile,receiver:t.receiver.ReceiverName,pcdDes:t.receiver.Province+" "+t.receiver.City+" "+t.receiver.District,pcdCode:[],pcdName:[],address:t.receiver.Address,isDefault:t.receiver.IsDefault,street:t.receiver.Street,streetId:t.receiver.StreetId,streetList:[],streetPicker:[]}}),l.pcdCode.push(t.receiver.ProvinceId),l.pcdCode.push(t.receiver.CityId),l.pcdCode.push(t.receiver.DistrictId),l.pcdName.push(t.receiver.Province),l.pcdName.push(t.receiver.City),l.pcdName.push(t.receiver.District),$("#city-picker").cityPicker({toolbarTemplate:'<header class="bar bar-nav"><button class="button button-link pull-right close-picker">              确定</button><h1 class="title">选择收货地址</h1></header>',onClose:a}),n(t.receiver.DistrictId,function(){d()}))}),$.showPreloader("请稍等")}else l=new r({el:"#page-address-edit",data:{receiverId:0,phone:"",receiver:"",pcdDes:"浙江省 嘉兴市 南湖区",pcdName:["浙江省","嘉兴市","南湖区"],pcdCode:[13,93,1e3],address:"",isDefault:!1,street:"建设街道",streetId:12111,streetList:[],streetPicker:[]}}),$("#city-picker").cityPicker({toolbarTemplate:'<header class="bar bar-nav"><button class="button button-link pull-right close-picker">          确定</button><h1 class="title">选择收货地址</h1></header>',onClose:a}),n(1e3,function(){d()});$(c).on("click",".button",function(r){r.preventDefault();var t="/address/modify-receiver";0===l.receiverId&&(t="/address/add-receiver"),e(t,{receiverId:l.receiverId,phone:l.phone,receiver:l.receiver,pcdCode:l.pcdCode,pcdName:l.pcdName,street:l.street,streetId:l.streetId,address:l.address,isDefault:l.isDefault},function(e,r){$.hidePreloader(),e?$.toast(e,1e3):window.history.back()}),$.showPreloader("保存中")})}),$.init()})}();