!function(){function e(e,t,r){$.ajax({type:"POST",url:e,data:t,timeout:15e3,success:function(e,t,i){-1===e.status?($.toast(e.msg,2e3),setTimeout(function(){location.href="/logout"},2e3)):e.status?r(null,e):r(e.msg,null)},error:function(t,i,s){console.error(e+" error: "+i+"##"+s),r("服务异常",null)}})}require.config({baseUrl:"../js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils.min"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(t,r){"use strict";t.config.delimiters=["${","}"],t.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-address-select",function(i,s,c){var d=r.getSearch(location),o=0;d.id&&(o=parseInt(d.id));var a=new t({el:"#page-address-select",data:{receivers:[],productIdStr:d.product}});e("/address/get-all-receiver",{},function(e,t){if(e)$.toast(e,1e3);else for(var r=t.receiver,i=r.length,s=0;i>s;s++){var c={};c.receiverId=r[s].SysNo,c.phone=r[s].ReceiverMobile,c.receiver=r[s].ReceiverName,c.pcdDes=r[s].Province+" "+r[s].City+" "+r[s].District+" "+r[s].Street,c.address=r[s].Address,c.isDefault=r[s].IsDefault,c.isSelected=c.receiverId===o,a.receivers.push(c)}})}),$(document).on("pageInit","#page-address-edit",function(i,s,c){function d(){$("#street-picker").picker({toolbarTemplate:'<header class="bar bar-nav"><button class="button button-link pull-right close-picker">              确定</button><h1 class="title">选择街道</h1></header>',onClose:a,cols:[{textAlign:"center",values:l.streetPicker}]})}function o(){var e=l.pcdDes.split(" "),t=r.getPCD(e[0],e[1],e[2]);l.pcdCode.splice(0,l.pcdCode.length),l.pcdName.splice(0,l.pcdName.length),l.pcdCode.push(t.province.id),l.pcdCode.push(t.city.id),l.pcdCode.push(t.district.id),l.pcdName.push(e[0]),l.pcdName.push(e[1]),l.pcdName.push(e[2]),n(t.district.id,function(){l.street=l.streetPicker[0],d(),a()})}function a(){l.streetId=0;for(var e=0;e<l.streetList.length;e++){var t=l.streetList[e];if(t.Name===l.street)return void(l.streetId=t.SysNo)}}function n(t,r){e("/address/get-street",{districtId:t},function(e,t){if($.hidePreloader(),e)$.toast(e,1e3),r(e);else{l.streetList=t.street.slice(),l.streetPicker.splice(0,l.streetPicker.length);for(var i=0;i<l.streetList.length;i++)l.streetPicker.push(l.streetList[i].Name);r(null)}}),$.showPreloader("请稍等")}var l=void 0,u=r.getSearch(location),p=0;if(void 0!==u.type&&(p=parseInt(u.type)),"/address/modify"===location.pathname){if(!u.id)return void(location.href="/");var v=parseInt(u.id);e("/address/get-all-receiver",{receiverId:v},function(e,r){$.hidePreloader(),e?$.toast(e,1e3):(l=new t({el:"#page-address-edit",data:{type:p,receiverId:r.receiver.SysNo,phone:r.receiver.ReceiverMobile,receiver:r.receiver.ReceiverName,pcdDes:r.receiver.Province+" "+r.receiver.City+" "+r.receiver.District,pcdCode:[],pcdName:[],address:r.receiver.Address,isDefault:r.receiver.IsDefault,street:r.receiver.Street,streetId:r.receiver.StreetId,streetList:[],streetPicker:[]},computed:{btnTitle:function(){return 0===this.type?"完成":"保存并使用"}}}),l.pcdCode.push(r.receiver.ProvinceId),l.pcdCode.push(r.receiver.CityId),l.pcdCode.push(r.receiver.DistrictId),l.pcdName.push(r.receiver.Province),l.pcdName.push(r.receiver.City),l.pcdName.push(r.receiver.District),$("#city-picker").cityPicker({toolbarTemplate:'<header class="bar bar-nav"><button class="button button-link pull-right close-picker">              确定</button><h1 class="title">选择收货地址</h1></header>',onClose:o}),n(r.receiver.DistrictId,function(){d()}))}),$.showPreloader("请稍等")}else l=new t({el:"#page-address-edit",data:{type:p,receiverId:0,phone:"",receiver:"",pcdDes:"浙江省 嘉兴市 南湖区",pcdName:["浙江省","嘉兴市","南湖区"],pcdCode:[13,93,1e3],address:"",isDefault:!1,street:"建设街道",streetId:12111,streetList:[],streetPicker:[]},computed:{btnTitle:function(){return 0===this.type?"完成":"保存并使用"}}}),$("#city-picker").cityPicker({toolbarTemplate:'<header class="bar bar-nav"><button class="button button-link pull-right close-picker">          确定</button><h1 class="title">选择收货地址</h1></header>',onClose:o}),n(1e3,function(){d()});$(c).on("click",".button",function(t){t.preventDefault();var r="/address/modify-receiver";0===l.receiverId&&(r="/address/add-receiver"),e(r,{receiverId:l.receiverId,phone:l.phone,receiver:l.receiver,pcdCode:l.pcdCode,pcdName:l.pcdName,street:l.street,streetId:l.streetId,address:l.address,isDefault:l.isDefault},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):p?location.href="/book/confirm?id="+t.receiverId+"&product="+u.product:window.history.back()}),$.showPreloader("保存中")})}),$.init()})}();