!function(){function e(e,r,t){$.ajax({type:"POST",url:e,data:r,timeout:15e3,success:function(e,r,i){e.status?t(null,e):t(e.msg,null)},error:function(r,i,o){console.error(e+" error: "+i+"##"+o),t("服务异常",null)}})}require.config({baseUrl:"../js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(r,t){"use strict";r.config.delimiters=["${","}"],r.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-book-confirm",function(i,o,c){var s=t.getSearch(location),n=0;s.id&&(n=parseInt(s.id));var a=new r({el:"#page-book-confirm",data:{payment:1,receiver:null,cartsAry:[],countPrice:0,cartIds:[]}});e("/address/get-all-receiver",{},function(e,r){if(e)$.toast(e,1e3);else{var t=r.receiver,i=t.length,o=0;if(n>0){for(o=0;i>o;o++)if(t[o].SysNo===n){a.receiver={},a.receiver.receiverId=t[o].SysNo,a.receiver.phone=t[o].ReceiverPhone,a.receiver.receiver=t[o].ReceiverName,a.receiver.pcdDes=t[o].Province+" "+t[o].City+" "+t[o].District,a.receiver.address=t[o].Address;break}}else for(o=0;i>o;o++)if(t[o].IsDefault){a.receiver={},a.receiver.receiverId=t[o].SysNo,a.receiver.phone=t[o].ReceiverPhone,a.receiver.receiver=t[o].ReceiverName,a.receiver.pcdDes=t[o].Province+" "+t[o].City+" "+t[o].District,a.receiver.address=t[o].Address;break}null===a.receiver&&i>0&&(a.receiver={},a.receiver.receiverId=t[0].SysNo,a.receiver.phone=t[0].ReceiverPhone,a.receiver.receiver=t[0].ReceiverName,a.receiver.pcdDes=t[0].Province+" "+t[0].City+" "+t[0].District,a.receiver.address=t[0].Address)}}),e("/cart/cart-info",{},function(e,r){if(e)$.toast(e,1e3);else{for(var t=r.cart,i=t.length,o=null,c={},s=0;i>s;s++){o=t[s];var n={};void 0===c[o.ProductSysNo]?(c[o.ProductSysNo]={},c[o.ProductSysNo].name=o.Name,c[o.ProductSysNo].productId=o.ProductSysNo,c[o.ProductSysNo].image=o.Images.length>0?o.Images[0].ImgUrl:"",c[o.ProductSysNo].skus=[],c[o.ProductSysNo].checked=!0,c[o.ProductSysNo].stock=o.Stock,n.cartId=o.SysId,n.skuId=o.SkuSysNo,n.size=o.SizeName,n.qty=o.Qty,n.price=o.Price,a.countPrice+=n.price*n.qty,c[o.ProductSysNo].skus.push(n),a.cartIds.push(n.cartId)):(n.cartId=o.SysId,n.skuId=o.SkuSysNo,n.size=o.SizeName,n.qty=o.Qty,n.price=o.Price,a.countPrice+=n.price*n.qty,c[o.ProductSysNo].skus.push(n),a.cartIds.push(n.cartId))}for(var u in c)c.hasOwnProperty(u)&&a.cartsAry.push(c[u])}}),$(c).on("click","#submitBook",function(r){r.preventDefault(),e("/book/confirm",{receiverId:a.receiver.receiverId,logistics:"快递",payment:a.payment,cartIds:JSON.stringify(a.cartIds)},function(e,r){if($.hidePreloader(),e)$.toast(e,1e3);else{if(console.log(JSON.stringify(r)),1===a.payment)return void(location.href="/book/pay-way");if(2===a.payment)return void(location.href="/book/complete")}}),$.showPreloader("提交订单...")})}),$(document).on("pageInit","#page-book-complete",function(e,t,i){new r({el:"#page-book-complete",data:{}})}),$(document).on("pageInit","#page-book-pay-way",function(e,t,i){new r({el:"#page-book-pay-way",data:{}})}),$(document).on("pageInit","#page-book-detail",function(e,i,o){var c=t.getSearch(location);new r({el:"#page-book-detail",data:{type:parseInt(c.status)},computed:{bookStatus:function(){return 1===this.type?"待付款":2===this.type?"待审核":3===this.type?"已完成":4===this.type?"已取消":5===this.type?"已发货":6===this.type?"待发货":void 0},isNeedPay:function(){return 1===this.type},operateName:function(){return 1===this.type||2===this.type?"取消订单":3===this.type||4===this.type||5===this.type?"再次购买":void 0},isOperate:function(){return 6!==this.type}}})}),$.init()})}();