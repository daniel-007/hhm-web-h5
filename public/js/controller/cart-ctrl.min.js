!function(){function t(t,s,r){$.ajax({type:"POST",url:t,data:s,timeout:15e3,success:function(t,s,c){t.status?r(null,t):r(t.msg,null)},error:function(s,c,e){console.error(t+" error: "+c+"##"+e),r("服务异常",null)}})}require.config({baseUrl:"../js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(s,r){"use strict";s.config.delimiters=["${","}"],s.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-cart",function(c,e,a){function i(t){for(var s=0,r=0,c=null,e=0;e<t.length;e++){r=t[e],c=f.cartsObj[r].skus;for(var a=0;a<c.length;a++)s+=c[a].qty*c[a].price}f.total=s}function o(s,r){$.confirm("确定删除该商品吗?",function(){t("/cart/del-cart",{cartId:r},function(t,c){if($.hidePreloader(),t)$.toast(t,1e3);else for(var e=f.cartsAry,a=e.length,o=0;a>o;o++){var u=e[o];if(u.productId===s){if(1===u.skus.length){f.cartsAry.splice(o,1),delete f.cartsObj[s];for(var n=0;n<f.buyList.length;n++)if(s===f.buyList[n]){f.buyList.splice(n,1);break}}else for(var l=0;l<u.skus.length;l++)if(r===u.skus[l].cartId){u.skus.splice(l,1),i(f.buyList);break}break}}}),$.showPreloader("请稍等...")},function(){})}function u(s,r){console.log(r);for(var c=f.cartsObj[s],e=c.skus,a=null,o=0;o<e.length;o++)if(a=e[o],a.cartId==r){if(a.qty+1>c.stock)return void $.toast("库存不足！");a.qty++,i(f.buyList),t("/cart/modify-cart-qty",{cartId:r,qty:a.qty},function(t,s){t&&($.toast(t,1e3),a.qty--,i(f.buyList))});break}}function n(s,r){for(var c=f.cartsObj[s],e=c.skus,a=null,o=0;o<e.length;o++)if(a=e[o],a.cartId==r){if(1===a.qty)return;a.qty--,i(f.buyList),t("/cart/modify-cart-qty",{cartId:r,qty:a.qty},function(t,s){t&&($.toast(t,1e3),a.qty++,i(f.buyList))});break}}function l(t){d=t}function y(s,r){for(var c=f.cartsObj[s],e=c.skus,a=null,o=0;o<e.length;o++)if(a=e[o],a.cartId==r){if(""===a.qty)return a.qty=d,void i(f.buyList);i(f.buyList),t("/cart/modify-cart-qty",{cartId:r,qty:a.qty},function(t,s){t&&($.toast(t,1e3),a.qty=d,i(f.buyList))});break}}var d=0,f=new s({el:"#page-cart",data:{allChecked:!0,cartsAry:[],cartsObj:{},buyList:[],total:0,message:0},methods:{delSku:o,addQty:u,subQty:n,editQty:y,onFocusNum:l}});t("/users/get-notice-count",{},function(t,s){t||(f.message=s.count)}),f.$watch("buyList",function(t,s){i(t)}),$(a).on("keyup",".txt-num",function(){var t=$(this).val();$(this).val(t.replace(/[^\d]/g,""))}),t("/cart/cart-info",{},function(t,s){if($.hidePreloader(),t)$.toast(t,1e3);else{for(var r=s.cart,c=r.length,e=null,i=0;c>i;i++){e=r[i];var o={};void 0===f.cartsObj[e.ProductSysNo]?(f.cartsObj[e.ProductSysNo]={},f.cartsObj[e.ProductSysNo].name=e.Name,f.cartsObj[e.ProductSysNo].productId=e.ProductSysNo,f.cartsObj[e.ProductSysNo].image=e.Images.length>0?e.Images[0].ImgUrl:"",f.cartsObj[e.ProductSysNo].skus=[],f.cartsObj[e.ProductSysNo].checked=!0,f.cartsObj[e.ProductSysNo].stock=e.Stock,o.cartId=e.SysId,o.skuId=e.SkuSysNo,o.size=e.SizeName,o.qty=e.Qty,o.price=e.Price,f.cartsObj[e.ProductSysNo].skus.push(o)):(o.cartId=e.SysId,o.skuId=e.SkuSysNo,o.size=e.SizeName,o.qty=e.Qty,o.price=e.Price,f.cartsObj[e.ProductSysNo].skus.push(o))}for(var u in f.cartsObj)f.cartsObj.hasOwnProperty(u)&&(f.cartsAry.push(f.cartsObj[u]),f.buyList.push(f.cartsObj[u].productId));f.$nextTick(function(){$(a).on("click",".my-nav-bar .label-checkbox",function(t){if(f.allChecked){f.buyList.splice(0,f.buyList.length);for(var s in f.cartsObj)f.cartsObj.hasOwnProperty(s)&&f.buyList.push(f.cartsObj[s].productId)}else f.buyList.splice(0,f.buyList.length)}),$(a).on("click",".my-list-cart .label-checkbox",function(){$(this).is(":checked")||(f.allChecked=!1)})})}}),$.showPreloader("请稍等..."),f.$watch("addCartNum1",function(t,c){""!==t&&(r.isPositiveNum(t)||($.toast("请输入正确的购买数量",500),s.nextTick(function(){cartVm.addCartNum1=c})))})}),$.init()})}();