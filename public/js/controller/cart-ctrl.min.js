!function(){function t(t,i,o){$.ajax({type:"POST",url:t,data:i,timeout:15e3,success:function(t,i,r){-1===t.status?($.toast(t.msg,2e3),setTimeout(function(){location.href="/logout"},2e3)):t.status?o(null,t):o(t.msg,null)},error:function(i,r,s){console.error(t+" error: "+r+"##"+s),o("服务异常",null)}})}require.config({baseUrl:"../js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils.min"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(i,o){"use strict";i.config.delimiters=["${","}"],i.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-cart",function(r,s,c){function e(t){var i=k.cartsAry[t],o=i.skus.filter(function(t){return t.isSeckillProduct});return o.length>0?void(location.href="/product/secKill-detail?id="+o[0].SeckillSysNo):(o=i.skus.filter(function(t){return t.isCombination}),void(o.length>0?location.href="/product/group-detail?id="+i.productId:location.href="/product/detail?id="+i.productId))}function n(t){for(var i=0,o=0,r=null,s=0;s<t.length;s++){o=t[s],r=k.cartsObj[o].skus;for(var c=0;c<r.length;c++)i+=r[c].qty*(100*r[c].price)}k.total=i/100,k.total=k.total.toFixed(2)}function u(){k.buyList.length>0?location.href="/book/confirm?product="+k.buyList.join("!"):$.toast("请先选购商品",1e3)}function a(i,o){$.confirm("确定删除该商品吗?",function(){t("/cart/del-cart",{cartId:o},function(t,r){if($.hidePreloader(),t)$.toast(t,1e3);else for(var s=k.cartsAry,c=s.length,e=0;c>e;e++){var u=s[e];if(u.productId===i){if(1===u.skus.length){k.cartsAry.splice(e,1),delete k.cartsObj[i];for(var a=0;a<k.buyList.length;a++)if(i===k.buyList[a]){k.buyList.splice(a,1);break}}else for(var l=0;l<u.skus.length;l++)if(o===u.skus[l].cartId){u.skus.splice(l,1),n(k.buyList);break}break}}}),$.showPreloader("请稍等...")},function(){})}function l(i,o){console.log(o);for(var r=k.cartsObj[i],s=r.skus,c=null,e=0;e<s.length;e++)if(c=s[e],c.cartId==o){if(c.isOnSeckill&&c.qty+1>c.TotalCount)return void $.toast("超出可采购数量！");if(!c.isOnSeckill&&c.qty+1>c.stock)return void $.toast("库存不足！");c.qty++,n(k.buyList),t("/cart/modify-cart-qty",{cartId:o,qty:c.qty},function(t,i){t&&($.toast(t,1e3),c.qty--,n(k.buyList))});break}}function d(i,o){for(var r=k.cartsObj[i],s=r.skus,c=null,e=0;e<s.length;e++)if(c=s[e],c.cartId==o){if(1===c.qty)return;c.qty--,n(k.buyList),t("/cart/modify-cart-qty",{cartId:o,qty:c.qty},function(t,i){t&&($.toast(t,1e3),c.qty++,n(k.buyList))});break}}function y(t){b=t}function f(i,o){for(var r=k.cartsObj[i],s=r.skus,c=null,e=0;e<s.length;e++)if(c=s[e],c.cartId==o){if(""===c.qty)return c.qty=b,void n(k.buyList);n(k.buyList),t("/cart/modify-cart-qty",{cartId:o,qty:c.qty},function(t,i){t&&($.toast(t,1e3),c.qty=b,n(k.buyList))});break}}var b=0,k=new i({el:"#page-cart",data:{allChecked:!0,cartsAry:[],cartsObj:{},buyList:[],total:0,message:0},methods:{delSku:a,addQty:l,subQty:d,editQty:f,onFocusNum:y,submitOrder:u,goToDetail:e}});t("/users/get-notice-count",{},function(t,i){t||(k.message=i.count)}),k.$watch("buyList",function(t,i){n(t)}),$(c).on("keyup",".txt-num",function(){var t=$(this).val();$(this).val(t.replace(/[^\d]/g,""))}),t("/cart/cart-info",{},function(t,i){if($.hidePreloader(),t)$.toast(t,1e3);else{for(var o=i.cart,r=o.length,s=null,e=0,n=0;r>n;n++){s=o[n];var u={};void 0===k.cartsObj[s.ProductSysNo]?(k.cartsObj[s.ProductSysNo]={},k.cartsObj[s.ProductSysNo].index=e++,k.cartsObj[s.ProductSysNo].name=s.Name,k.cartsObj[s.ProductSysNo].productId=s.ProductSysNo,k.cartsObj[s.ProductSysNo].image=s.Images.length>0?s.Images[0].ImgUrl:"",k.cartsObj[s.ProductSysNo].skus=[],k.cartsObj[s.ProductSysNo].checked=!0,u.TotalCount=s.TotalCount,u.cartId=s.SysId,u.skuId=s.SkuSysNo,u.size=s.SizeName,u.qty=s.Qty,u.price=s.Price,u.stock=s.Stock,u.isOnSeckill=s.isOnSeckill,u.isSeckillProduct=s.isSeckillProduct,u.isCombination=s.isCombination,u.SeckillSysNo=s.SeckillSysNo,u.TotalCount=s.TotalCount,k.cartsObj[s.ProductSysNo].skus.push(u)):(u.cartId=s.SysId,u.skuId=s.SkuSysNo,u.size=s.SizeName,u.qty=s.Qty,u.price=s.Price,u.stock=s.Stock,u.isOnSeckill=s.isOnSeckill,u.isSeckillProduct=s.isSeckillProduct,u.isCombination=s.isCombination,u.TotalCount=s.TotalCount,k.cartsObj[s.ProductSysNo].skus.push(u))}k.cartsAry.sort(function(t,i){return t.index-i.index});for(var a in k.cartsObj)k.cartsObj.hasOwnProperty(a)&&(k.cartsAry.push(k.cartsObj[a]),k.buyList.push(k.cartsObj[a].productId));k.cartsAry.sort(function(t,i){return t.index-i.index}),k.$nextTick(function(){$(c).on("click",".my-nav-bar .label-checkbox",function(t){if(k.allChecked)k.buyList.splice(0,k.buyList.length);else{k.buyList.splice(0,k.buyList.length);for(var i in k.cartsObj)k.cartsObj.hasOwnProperty(i)&&k.buyList.push(k.cartsObj[i].productId)}}),$(c).on("click",".my-list-cart .label-checkbox",function(){$(this).is(":checked")||(k.allChecked=!1)})})}}),$.showPreloader("请稍等..."),k.$watch("addCartNum1",function(t,r){""!==t&&(o.isPositiveNum(t)||($.toast("请输入正确的购买数量",500),i.nextTick(function(){cartVm.addCartNum1=r})))})}),$.init()})}();