!function(){function t(t,s,r){$.ajax({type:"POST",url:t,data:s,timeout:15e3,success:function(t,s,c){t.status?r(null,t):r(t.msg,null)},error:function(s,c,o){console.error(t+" error: "+c+"##"+o),r("服务异常",null)}})}require.config({baseUrl:"../js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils.min"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(s,r){"use strict";s.config.delimiters=["${","}"],s.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-cart",function(c,o,e){function i(t){for(var s=0,r=0,c=null,o=0;o<t.length;o++){r=t[o],c=b.cartsObj[r].skus;for(var e=0;e<c.length;e++)s+=c[e].qty*(100*c[e].price)}b.total=s/100}function u(){b.buyList.length>0?location.href="/book/confirm?product="+b.buyList.join("!"):$.toast("请先选购商品",1e3)}function a(s,r){$.confirm("确定删除该商品吗?",function(){t("/cart/del-cart",{cartId:r},function(t,c){if($.hidePreloader(),t)$.toast(t,1e3);else for(var o=b.cartsAry,e=o.length,u=0;e>u;u++){var a=o[u];if(a.productId===s){if(1===a.skus.length){b.cartsAry.splice(u,1),delete b.cartsObj[s];for(var n=0;n<b.buyList.length;n++)if(s===b.buyList[n]){b.buyList.splice(n,1);break}}else for(var l=0;l<a.skus.length;l++)if(r===a.skus[l].cartId){a.skus.splice(l,1),i(b.buyList);break}break}}}),$.showPreloader("请稍等...")},function(){})}function n(s,r){console.log(r);for(var c=b.cartsObj[s],o=c.skus,e=null,u=0;u<o.length;u++)if(e=o[u],e.cartId==r){if(e.isSeckillProduct&&e.qty+1>e.TotalCount)return void $.toast("超出可采购数量！");if(!e.isSeckillProduct&&e.qty+1>e.stock)return void $.toast("库存不足！");e.qty++,i(b.buyList),t("/cart/modify-cart-qty",{cartId:r,qty:e.qty},function(t,s){t&&($.toast(t,1e3),e.qty--,i(b.buyList))});break}}function l(s,r){for(var c=b.cartsObj[s],o=c.skus,e=null,u=0;u<o.length;u++)if(e=o[u],e.cartId==r){if(1===e.qty)return;e.qty--,i(b.buyList),t("/cart/modify-cart-qty",{cartId:r,qty:e.qty},function(t,s){t&&($.toast(t,1e3),e.qty++,i(b.buyList))});break}}function y(t){f=t}function d(s,r){for(var c=b.cartsObj[s],o=c.skus,e=null,u=0;u<o.length;u++)if(e=o[u],e.cartId==r){if(""===e.qty)return e.qty=f,void i(b.buyList);i(b.buyList),t("/cart/modify-cart-qty",{cartId:r,qty:e.qty},function(t,s){t&&($.toast(t,1e3),e.qty=f,i(b.buyList))});break}}var f=0,b=new s({el:"#page-cart",data:{allChecked:!0,cartsAry:[],cartsObj:{},buyList:[],total:0,message:0},methods:{delSku:a,addQty:n,subQty:l,editQty:d,onFocusNum:y,submitOrder:u}});t("/users/get-notice-count",{},function(t,s){t||(b.message=s.count)}),b.$watch("buyList",function(t,s){i(t)}),$(e).on("keyup",".txt-num",function(){var t=$(this).val();$(this).val(t.replace(/[^\d]/g,""))}),t("/cart/cart-info",{},function(t,s){if($.hidePreloader(),t)$.toast(t,1e3);else{for(var r=s.cart,c=r.length,o=null,i=0;c>i;i++){o=r[i];var u={};void 0===b.cartsObj[o.ProductSysNo]?(b.cartsObj[o.ProductSysNo]={},b.cartsObj[o.ProductSysNo].name=o.Name,b.cartsObj[o.ProductSysNo].productId=o.ProductSysNo,b.cartsObj[o.ProductSysNo].image=o.Images.length>0?o.Images[0].ImgUrl:"",b.cartsObj[o.ProductSysNo].skus=[],b.cartsObj[o.ProductSysNo].checked=!0,u.TotalCount=o.TotalCount,u.cartId=o.SysId,u.skuId=o.SkuSysNo,u.size=o.SizeName,u.qty=o.Qty,u.price=o.Price,u.stock=o.Stock,u.isSeckillProduct=o.isSeckillProduct,u.TotalCount=o.TotalCount,b.cartsObj[o.ProductSysNo].skus.push(u)):(u.cartId=o.SysId,u.skuId=o.SkuSysNo,u.size=o.SizeName,u.qty=o.Qty,u.price=o.Price,u.stock=o.Stock,u.isSeckillProduct=o.isSeckillProduct,u.TotalCount=o.TotalCount,b.cartsObj[o.ProductSysNo].skus.push(u))}for(var a in b.cartsObj)b.cartsObj.hasOwnProperty(a)&&(b.cartsAry.push(b.cartsObj[a]),b.buyList.push(b.cartsObj[a].productId));b.$nextTick(function(){$(e).on("click",".my-nav-bar .label-checkbox",function(t){if(b.allChecked)b.buyList.splice(0,b.buyList.length);else{b.buyList.splice(0,b.buyList.length);for(var s in b.cartsObj)b.cartsObj.hasOwnProperty(s)&&b.buyList.push(b.cartsObj[s].productId)}}),$(e).on("click",".my-list-cart .label-checkbox",function(){$(this).is(":checked")||(b.allChecked=!1)})})}}),$.showPreloader("请稍等..."),b.$watch("addCartNum1",function(t,c){""!==t&&(r.isPositiveNum(t)||($.toast("请输入正确的购买数量",500),s.nextTick(function(){cartVm.addCartNum1=c})))})}),$.init()})}();