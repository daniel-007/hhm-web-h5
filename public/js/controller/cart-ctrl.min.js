!function(){function t(t,r,s){$.ajax({type:"POST",url:t,data:r,timeout:15e3,success:function(t,r,c){t.status?s(null,t):s(t.msg,null)},error:function(r,c,e){console.error(t+" error: "+c+"##"+e),s("服务异常",null)}})}require.config({baseUrl:"../js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(r,s){"use strict";r.config.delimiters=["${","}"],r.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-cart",function(c,e,a){function o(t){for(var r=0,s=0,c=null,e=0;e<t.length;e++){s=t[e],c=b.cartsObj[s].skus;for(var a=0;a<c.length;a++)r+=c[a].qty*(100*c[a].price)}b.total=r/100}function i(){b.cartsAry.length>0?location.href="/book/confirm":$.toast("请先选购商品",1e3)}function u(r,s){$.confirm("确定删除该商品吗?",function(){t("/cart/del-cart",{cartId:s},function(t,c){if($.hidePreloader(),t)$.toast(t,1e3);else for(var e=b.cartsAry,a=e.length,i=0;a>i;i++){var u=e[i];if(u.productId===r){if(1===u.skus.length){b.cartsAry.splice(i,1),delete b.cartsObj[r];for(var n=0;n<b.buyList.length;n++)if(r===b.buyList[n]){b.buyList.splice(n,1);break}}else for(var l=0;l<u.skus.length;l++)if(s===u.skus[l].cartId){u.skus.splice(l,1),o(b.buyList);break}break}}}),$.showPreloader("请稍等...")},function(){})}function n(r,s){console.log(s);for(var c=b.cartsObj[r],e=c.skus,a=null,i=0;i<e.length;i++)if(a=e[i],a.cartId==s){if(a.qty+1>c.stock)return void $.toast("库存不足！");a.qty++,o(b.buyList),t("/cart/modify-cart-qty",{cartId:s,qty:a.qty},function(t,r){t&&($.toast(t,1e3),a.qty--,o(b.buyList))});break}}function l(r,s){for(var c=b.cartsObj[r],e=c.skus,a=null,i=0;i<e.length;i++)if(a=e[i],a.cartId==s){if(1===a.qty)return;a.qty--,o(b.buyList),t("/cart/modify-cart-qty",{cartId:s,qty:a.qty},function(t,r){t&&($.toast(t,1e3),a.qty++,o(b.buyList))});break}}function y(t){f=t}function d(r,s){for(var c=b.cartsObj[r],e=c.skus,a=null,i=0;i<e.length;i++)if(a=e[i],a.cartId==s){if(""===a.qty)return a.qty=f,void o(b.buyList);o(b.buyList),t("/cart/modify-cart-qty",{cartId:s,qty:a.qty},function(t,r){t&&($.toast(t,1e3),a.qty=f,o(b.buyList))});break}}var f=0,b=new r({el:"#page-cart",data:{allChecked:!0,cartsAry:[],cartsObj:{},buyList:[],total:0,message:0},methods:{delSku:u,addQty:n,subQty:l,editQty:d,onFocusNum:y,submitOrder:i}});t("/users/get-notice-count",{},function(t,r){t||(b.message=r.count)}),b.$watch("buyList",function(t,r){o(t)}),$(a).on("keyup",".txt-num",function(){var t=$(this).val();$(this).val(t.replace(/[^\d]/g,""))}),t("/cart/cart-info",{},function(t,r){if($.hidePreloader(),t)$.toast(t,1e3);else{for(var s=r.cart,c=s.length,e=null,o=0;c>o;o++){e=s[o];var i={};void 0===b.cartsObj[e.ProductSysNo]?(b.cartsObj[e.ProductSysNo]={},b.cartsObj[e.ProductSysNo].name=e.Name,b.cartsObj[e.ProductSysNo].productId=e.ProductSysNo,b.cartsObj[e.ProductSysNo].image=e.Images.length>0?e.Images[0].ImgUrl:"",b.cartsObj[e.ProductSysNo].skus=[],b.cartsObj[e.ProductSysNo].checked=!0,b.cartsObj[e.ProductSysNo].stock=e.Stock,i.cartId=e.SysId,i.skuId=e.SkuSysNo,i.size=e.SizeName,i.qty=e.Qty,i.price=e.Price,b.cartsObj[e.ProductSysNo].skus.push(i)):(i.cartId=e.SysId,i.skuId=e.SkuSysNo,i.size=e.SizeName,i.qty=e.Qty,i.price=e.Price,b.cartsObj[e.ProductSysNo].skus.push(i))}for(var u in b.cartsObj)b.cartsObj.hasOwnProperty(u)&&(b.cartsAry.push(b.cartsObj[u]),b.buyList.push(b.cartsObj[u].productId));b.$nextTick(function(){$(a).on("click",".my-nav-bar .label-checkbox",function(t){if(b.allChecked)b.buyList.splice(0,b.buyList.length);else{b.buyList.splice(0,b.buyList.length);for(var r in b.cartsObj)b.cartsObj.hasOwnProperty(r)&&b.buyList.push(b.cartsObj[r].productId)}}),$(a).on("click",".my-list-cart .label-checkbox",function(){$(this).is(":checked")||(b.allChecked=!1)})})}}),$.showPreloader("请稍等..."),b.$watch("addCartNum1",function(t,c){""!==t&&(s.isPositiveNum(t)||($.toast("请输入正确的购买数量",500),r.nextTick(function(){cartVm.addCartNum1=c})))})}),$.init()})}();