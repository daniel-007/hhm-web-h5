!function(){function t(t,o,c){$.ajax({type:"POST",url:t,data:o,timeout:15e3,success:function(t,o,n){t.status?c(null,t):c(t.msg,null)},error:function(o,n,e){console.error(t+" error: "+n+"##"+e),c("服务异常",null)}})}function o(o,c,n,e){var u={};return u.url=o,u.cid=n||0,u.childId=e||0,u.pageSize=c,u.pageId=0,u.addItems=function(o){var c=this;t(this.url,{CId:u.cid,ChildCId:u.childId,pageId:this.pageId,pageSize:this.pageSize},function(t,n){t?o(t,null):(c.pageId++,o(null,n))})},u}function c(t){var o=Math.floor(t/36e5),c=Math.floor(t%864e5%36e5/6e4),n=Math.floor(t%864e5%36e5%6e4/1e3);return o=o>9?o:"0"+o,c=c>9?c:"0"+c,n=n>9?n:"0"+n,o+":"+c+":"+n}require.config({baseUrl:"../js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils.min"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(n,e){"use strict";n.config.delimiters=["${","}"],n.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-product-class",function(o,c,e){var u=new n({el:"#page-product-class",data:{categories:[],search:"",message:0}});t("/users/get-notice-count",{},function(t,o){t||(u.message=o.count)}),t("/product/class",{},function(t,o){t?$.toast(t,1e3):u.categories=o.category.slice()}),$(e).on("click",".icon-clear",function(){u.search=""})}),$(document).on("pageInit","#page-product-detail",function(o,c,u){function a(){$.popup(".popup-cart")}function r(){return""===l.addCartNum?(l.addCartNum=1,void $.toast("请输入正确的购买数量",1e3)):(t("/cart/add-to-cart",{productId:l.product.SysNo,skuId:l.curSkuId,qty:l.addCartNum},function(t,o){t?$.toast(t,1e3):i()}),void(l.addCartNum=1))}function i(){t("/cart/get-count-in-cart",{},function(t,o){t||(s.cartNum=o.count)})}var d=e.getSearch(location);if(!d.id)return void(location.pathname="/");var s=new n({el:"#page-product-detail",data:{cartNum:0,product:null,style:[],skuImg:[]},computed:{liked:function(){return this.product.isLike?"已收藏":"收藏"}},methods:{OpenCart:a}}),l=new n({el:"#popup-cart",data:{addCartNum:1,product:null,curPrice:0,curImg:"",curSkuId:0},methods:{addToCart:r}});i(),t("/product/detail",{productId:parseInt(d.id)},function(t,o){if(t)$.toast(t,1e3);else{s.product=e.clone(o.product);var c=0;l.product=s.product;var u=s.product.Skus;for(l.curSkuId=u[0].SysNo,l.curPrice=u[0].Price,l.curImg=u[0].Images[0].ImgUrl,c=0;c<u.length;c++)s.style.push(u[c].SizeName),u[c].Images.length>0&&s.skuImg.push(u[c].Images[0].ImgUrl);n.nextTick(function(){$(function(){$(".swiper-container").swiper({pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:10,centeredSlides:!0,autoplay:2500,autoplayDisableOnInteraction:!1})})})}}),$(u).on("click",".like",function(){t(s.product.isLike?"/users/del-fav":"/users/add-fav",{productId:parseInt(d.id)},function(t,o){$.hidePreloader(),t?$.toast(t,1e3):s.product.isLike=!s.product.isLike}),s.product.isLike?$.showPreloader("取消收藏..."):$.showPreloader("收藏...")}),$(u).on("click",".my-back-top",function(){$(".content").scrollTop(0)}),l.$watch("addCartNum",function(t,o){""!==t&&(e.isPositiveNum(t)||($.toast("请输入正确的购买数量",500),n.nextTick(function(){l.addCartNum=o})))}),$(document).on("click",".icon-close.close-popup",function(){l.addCartNum=1}),$(document).on("click",".em-op-d",function(){l.addCartNum>1&&l.addCartNum--}),$(document).on("click",".em-op-a",function(){l.addCartNum++}),$(document).on("click",".my-ul-spec li",function(){$(".my-ul-spec li").removeClass("my-spec-on"),$(this).addClass("my-spec-on");var t=$(this).val(),o=s.product.Skus[t];l.curSkuId=o.SysNo,l.curPrice=o.Price,l.curImg=o.Images[0].ImgUrl})}),$(document).on("pageInit","#page-secKill-product-detail",function(o,c,u){function a(){$.popup(".popup-cart")}function r(){return""===l.addCartNum?(l.addCartNum=1,void $.toast("请输入正确的购买数量",1e3)):(t("/cart/add-to-cart",{productId:l.product.SysNo,skuId:l.curSkuId,qty:l.addCartNum},function(t,o){t?$.toast(t,1e3):i()}),void(l.addCartNum=1))}function i(){t("/cart/get-count-in-cart",{},function(t,o){t||(s.cartNum=o.count)})}var d=e.getSearch(location);if(!d.id)return void(location.pathname="/");var s=new n({el:"#page-secKill-product-detail",data:{cartNum:0,product:null,style:[],skuImg:[]},computed:{liked:function(){return this.product.isLike?"已收藏":"收藏"}},methods:{OpenCart:a}}),l=new n({el:"#popup-cart",data:{addCartNum:1,product:null,curPrice:0,curImg:"",curSkuId:0,total:0,limit:0},methods:{addToCart:r}});i(),t("/product/secKill-detail",{productId:parseInt(d.id)},function(t,o){if(t)$.toast(t,1e3);else{s.product=e.clone(o.product),l.product=s.product,l.curPrice=s.product.SeckillPrice,l.total=s.product.TotalCount,l.limit=s.product.LimitBuyCount;var c=s.product.Skus;l.curSkuId=c[0].SysNo,l.curImg=c[0].Images[0].ImgUrl;for(var u=0;u<c.length;u++)s.style.push(c[u].SizeName),c[u].Images.length>0&&s.skuImg.push(c[u].Images[0].ImgUrl);n.nextTick(function(){$(function(){$(".swiper-container").swiper({pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:10,centeredSlides:!0,autoplay:2500,autoplayDisableOnInteraction:!1})})})}}),$(u).on("click",".like",function(){t(s.product.isLike?"/users/del-fav":"/users/add-fav",{productId:s.product.SysNo},function(t,o){$.hidePreloader(),t?$.toast(t,1e3):s.product.isLike=!s.product.isLike}),s.product.isLike?$.showPreloader("取消收藏..."):$.showPreloader("收藏...")}),$(u).on("click",".my-back-top",function(){$(".content").scrollTop(0)}),l.$watch("addCartNum",function(t,o){return""!==t?e.isPositiveNum(t)?t>l.total?($.toast("超出库存库存！",1e3),void n.nextTick(function(){l.addCartNum=o})):t>l.limit?($.toast("超出限购数量！",1e3),void n.nextTick(function(){l.addCartNum=o})):void 0:($.toast("请输入正确的购买数量",500),void n.nextTick(function(){l.addCartNum=o})):void 0}),$(document).on("click",".icon-close.close-popup",function(){l.addCartNum=1}),$(document).on("click",".em-op-d",function(){l.addCartNum>1&&l.addCartNum--}),$(document).on("click",".em-op-a",function(){return l.total<l.addCartNum+1?void $.toast("超出库存库存！",500):l.limit<l.addCartNum+1?void $.toast("超出限购数量！",500):void l.addCartNum++}),$(document).on("click",".my-ul-spec li",function(){$(".my-ul-spec li").removeClass("my-spec-on"),$(this).addClass("my-spec-on");var t=$(this).val(),o=s.product.Skus[t];l.curSkuId=o.SysNo,l.curPrice=o.Price,l.curImg=o.Images[0].ImgUrl})}),$(document).on("pageInit","#page-product-group-detail",function(o,c,u){function a(){$.popup(".popup-cart")}function r(){return""===l.addCartNum?(l.addCartNum=1,void $.toast("请输入正确的购买数量",1e3)):(t("/cart/add-to-cart",{productId:l.product.SysNo,skuId:l.curSkuId,qty:l.addCartNum},function(t,o){t?$.toast(t,1e3):i()}),void(l.addCartNum=1))}function i(){t("/cart/get-count-in-cart",{},function(t,o){t||(s.cartNum=o.count)})}var d=e.getSearch(location);if(!d.id)return void(location.pathname="/");var s=new n({el:"#page-product-group-detail",data:{cartNum:0,product:null,style:[],skuImg:[]},computed:{liked:function(){return this.product.isLike?"已收藏":"收藏"}},methods:{OpenCart:a}}),l=new n({el:"#popup-cart",data:{addCartNum:1,product:null,curPrice:0,curImg:"",curSkuId:0},methods:{addToCart:r}});i(),t("/product/group-detail",{productId:parseInt(d.id)},function(t,o){if(t)$.toast(t,1e3);else{s.product=e.clone(o.product),l.product=s.product;var c=s.product.Skus;l.curSkuId=c[0].SysNo,l.curPrice=c[0].Price,l.curImg=c[0].Images[0].ImgUrl;for(var u=0;u<c.length;u++)s.style.push(c[u].SizeName),c[u].Images.length>0&&s.skuImg.push(c[u].Images[0].ImgUrl);n.nextTick(function(){$(function(){$(".swiper-container").swiper({pagination:".swiper-pagination",paginationClickable:!0,spaceBetween:10,centeredSlides:!0,autoplay:2500,autoplayDisableOnInteraction:!1})})})}}),$(u).on("click",".like",function(){t(s.product.isLike?"/users/del-fav":"/users/add-fav",{productId:parseInt(d.id)},function(t,o){$.hidePreloader(),t?$.toast(t,1e3):s.product.isLike=!s.product.isLike}),s.product.isLike?$.showPreloader("取消收藏..."):$.showPreloader("收藏...")}),$(u).on("click",".my-back-top",function(){$(".content").scrollTop(0)}),l.$watch("addCartNum",function(t,o){""!==t&&(e.isPositiveNum(t)||($.toast("请输入正确的购买数量",500),n.nextTick(function(){l.addCartNum=o})))}),$(document).on("click",".icon-close.close-popup",function(){l.addCartNum=1}),$(document).on("click",".em-op-d",function(){l.addCartNum>1&&l.addCartNum--}),$(document).on("click",".em-op-a",function(){l.addCartNum++}),$(document).on("click",".my-ul-spec li",function(){$(".my-ul-spec li").removeClass("my-spec-on"),$(this).addClass("my-spec-on");var t=$(this).val(),o=s.product.Skus[t];l.curSkuId=o.SysNo,l.curPrice=o.Price,l.curImg=o.Images[0].ImgUrl})}),$(document).on("pageInit","#page-product-list",function(c,u,a){function r(){t("/cart/get-count-in-cart",{},function(t,o){t||(s.cartNum=o.count)})}function i(t){f.product=s.products[t],f.curSkuId=f.product.SkuList[0].SysNo,f.curPrice=f.product.SkuList[0].Price,f.curImg=f.product.SkuList[0].Images[0].ImgUrl,$.popup(".popup-cart")}function d(){return""===f.addCartNum?(f.addCartNum=1,void $.toast("请输入正确的购买数量",1e3)):(t("/cart/add-to-cart",{productId:f.product.SysNo,skuId:f.curSkuId,qty:f.addCartNum},function(t,o){t?$.toast(t,1e3):r()}),void(f.addCartNum=1))}var s=new n({el:"#page-product-list",data:{search:"",products:[],count:0,cartNum:0},methods:{OpenCart:i}}),l=void 0,p=!1;if(r(),"/product/sales"===location.pathname)l=new o("/product/sales",10),l.addItems(function(t,o){t?$.toast(t,1e3):(s.count=o.count,s.products=s.products.concat(o.products))});else if("/product/new"===location.pathname)l=new o("/product/new",10),l.addItems(function(t,o){t?$.toast(t,1e3):(s.count=o.count,s.products=s.products.concat(o.products))});else if("/product/category"===location.pathname){var m=e.getSearch(location);if(!m.CId||!m.ChildCId)return void(location.pathname="/");l=new o("/product/category",10,parseInt(m.CId),parseInt(m.ChildCId)),l.addItems(function(t,o){t?$.toast(t,1e3):(s.count=o.count,s.products=s.products.concat(o.products))})}$(a).on("infinite",".infinite-scroll-bottom",function(){p||(p=!0,setTimeout(function(){return p=!1,s.products.length>=s.count?($.detachInfiniteScroll($(".infinite-scroll")),void $(".infinite-scroll-preloader").remove()):(l.addItems(function(t,o){t?$.toast(t,1e3):(s.count=o.count,s.products=s.products.concat(o.products))}),void $.refreshScroller())},1e3))});var f=new n({el:"#popup-cart",data:{addCartNum:1,product:null,curPrice:0,curImg:"",curSkuId:0},methods:{addToCart:d}});$(a).on("click",".icon-clear",function(){s.search=""}),f.$watch("addCartNum",function(t,o){""!==t&&(e.isPositiveNum(t)||($.toast("请输入正确的购买数量",500),n.nextTick(function(){f.addCartNum=o})))}),$(document).on("click",".icon-close.close-popup",function(){event.preventDefault(),f.addCartNum=1}),$(document).on("click",".em-op-d",function(){f.addCartNum>1&&f.addCartNum--}),$(document).on("click",".em-op-a",function(){f.addCartNum++}),$(document).on("click",".my-ul-spec li",function(){$(".my-ul-spec li").removeClass("my-spec-on"),$(this).addClass("my-spec-on");var t=$(this).val(),o=f.product.SkuList[t];f.curPrice=o.Price,f.curImg=o.Images[0].ImgUrl,f.curSkuId=o.SysNo})}),$(document).on("pageInit","#page-product-group-list",function(c,u,a){function r(){t("/cart/get-count-in-cart",{},function(t,o){t||(s.cartNum=o.count)})}function i(t){m.product=s.products[t],m.curSkuId=m.product.SkuList[0].SysNo,m.curPrice=m.product.SkuList[0].Price,m.curImg=m.product.SkuList[0].Images[0].ImgUrl,$.popup(".popup-cart")}function d(){return""===m.addCartNum?(m.addCartNum=1,void $.toast("请输入正确的购买数量",1e3)):(t("/cart/add-to-cart",{productId:m.product.SysNo,skuId:m.curSkuId,qty:m.addCartNum},function(t,o){t?$.toast(t,1e3):r()}),void(m.addCartNum=1))}var s=new n({el:"#page-product-group-list",data:{search:"",products:[],count:0,cartNum:0},methods:{OpenCart:i}}),l=!1;r();var p=new o("/product/group",10);p.addItems(function(t,o){t?$.toast(t,1e3):(s.count=o.count,s.products=s.products.concat(o.products))}),$(a).on("infinite",".infinite-scroll-bottom",function(){l||(l=!0,setTimeout(function(){return l=!1,s.products.length>=s.count?($.detachInfiniteScroll($(".infinite-scroll")),void $(".infinite-scroll-preloader").remove()):(p.addItems(function(t,o){t?$.toast(t,1e3):(s.count=o.count,s.products=s.products.concat(o.products))}),void $.refreshScroller())},1e3))}),$(a).on("click",".icon-clear",function(){s.search=""});var m=new n({el:"#popup-cart",data:{addCartNum:1,product:null,curPrice:0,curImg:"",curSkuId:0},methods:{addToCart:d}});m.$watch("addCartNum",function(t,o){""!==t&&(e.isPositiveNum(t)||($.toast("请输入正确的购买数量",500),n.nextTick(function(){m.addCartNum=o})))}),$(document).on("click",".icon-close.close-popup",function(){event.preventDefault(),m.addCartNum=1}),$(document).on("click",".em-op-d",function(){m.addCartNum>1&&m.addCartNum--}),$(document).on("click",".em-op-a",function(){m.addCartNum++}),$(document).on("click",".my-ul-spec li",function(){$(".my-ul-spec li").removeClass("my-spec-on"),$(this).addClass("my-spec-on");var t=$(this).val(),o=m.product.SkuList[t];m.curPrice=o.Price,m.curImg=o.Images[0].ImgUrl,m.curSkuId=o.SysNo})}),$(document).on("pageInit","#page-recommend-list",function(c,u,a){function r(){t("/cart/get-count-in-cart",{},function(t,o){t||(s.cartNum=o.count)})}function i(t){f.product=s.products[t],f.curSkuId=f.product.SkuList[0].SysNo,f.curPrice=f.product.SkuList[0].Price,f.curImg=f.product.SkuList[0].Images[0].ImgUrl,$.popup(".popup-cart")}function d(){return""===f.addCartNum?(f.addCartNum=1,void $.toast("请输入正确的购买数量",1e3)):(t("/cart/add-to-cart",{productId:f.product.SysNo,skuId:f.curSkuId,qty:f.addCartNum},function(t,o){t?$.toast(t,1e3):r()}),void(f.addCartNum=1))}var s=new n({el:"#page-recommend-list",data:{search:"",products:[],count:0,cartNum:0},methods:{OpenCart:i}}),l=!1,p=e.getSearch(location);if(!p.id)return void(location.pathname="/");r();var m=new o("/product/recommend",10,parseInt(p.id));m.addItems(function(t,o){t?$.toast(t,1e3):(s.count=o.count,console.log("data:"+JSON.stringify(o)),s.products=s.products.concat(o.products))}),$(a).on("infinite",".infinite-scroll-bottom",function(){l||(l=!0,setTimeout(function(){return l=!1,s.products.length>=s.count?($.detachInfiniteScroll($(".infinite-scroll")),void $(".infinite-scroll-preloader").remove()):(m.addItems(function(t,o){t?$.toast(t,1e3):(s.count=o.count,s.products=s.products.concat(o.products))}),void $.refreshScroller())},1e3))}),$(a).on("click",".icon-clear",function(){s.search=""});var f=new n({el:"#popup-cart",data:{addCartNum:1,product:null,curPrice:0,curImg:"",curSkuId:0},methods:{addToCart:d}});f.$watch("addCartNum",function(t,o){""!==t&&(e.isPositiveNum(t)||($.toast("请输入正确的购买数量",500),n.nextTick(function(){f.addCartNum=o})))}),$(document).on("click",".icon-close.close-popup",function(){event.preventDefault(),f.addCartNum=1}),$(document).on("click",".em-op-d",function(){f.addCartNum>1&&f.addCartNum--}),$(document).on("click",".em-op-a",function(){f.addCartNum++}),$(document).on("click",".my-ul-spec li",function(){$(".my-ul-spec li").removeClass("my-spec-on"),$(this).addClass("my-spec-on");var t=$(this).val(),o=f.product.SkuList[t];f.curPrice=o.Price,f.curImg=o.Images[0].ImgUrl,f.curSkuId=o.SysNo})}),$(document).on("pageInit","#page-product-flash-deal-list",function(t,e,u){function a(t){var o=d.products[t];return 1!==o.killStatus?!1:void(location.href="/product/secKill-detail?id="+o.SysNo)}function r(t){if(t.RemainStartTotalSeconds>0)t.RemainStartTotalSeconds-=1e3,t.remainStart=c(t.RemainStartTotalSeconds);else{t.killStatus=1;var o=new Date(t.EndTime).getTime(),n=(new Date).getTime();t.RemainEndTotalSeconds=o-n}}function i(t){t.RemainEndTotalSeconds>0?(t.RemainEndTotalSeconds-=1e3,t.remainEnd=c(t.RemainEndTotalSeconds)):t.killStatus=0}var d=new n({el:"#page-product-flash-deal-list",data:{search:"",count:0,products:[]},methods:{goToDetail:a}}),s=new o("/product/secKill",10);s.addItems(function(t,o){if(t)$.toast(t,1e3);else{d.count=o.count;for(var n=o.products,e=n.length,u=null,a=0;e>a;a++)u=n[a],u.RemainStartTotalSeconds=1e3*parseInt(u.RemainStartTotalSeconds),u.RemainEndTotalSeconds=1e3*parseInt(u.RemainEndTotalSeconds),u.RemainEndTotalSeconds>0?(u.killStatus=1,u.remainEnd=c(u.RemainEndTotalSeconds)):u.RemainStartTotalSeconds>0?(u.killStatus=2,u.remainStart=c(u.RemainStartTotalSeconds)):u.killStatus=0;d.products=d.products.concat(o.products)}}),setInterval(function(){for(var t=d.products,o=t.length,c=null,n=0;o>n;n++)if(c=t[n],1===c.killStatus)i(c);else{if(2!==c.killStatus)continue;r(c)}},1e3),$(u).on("click",".icon-clear",function(){d.search=""})}),$.init()})}();