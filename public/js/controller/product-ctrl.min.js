!function(){function t(t,e,o){$.ajax({type:"POST",url:t,data:e,timeout:15e3,success:function(t,e,n){t.status?o(null,t):o(t.msg,null)},error:function(e,n,a){console.error(t+" error: "+n+"##"+a),o("服务异常",null)}})}function e(e,o,n,a){var c={};return c.url=e,c.cid=n||0,c.childId=a||0,c.pageSize=o,c.pageId=0,c.addItems=function(e){var o=this;t(this.url,{CId:c.cid,ChildCId:c.childId,pageId:this.pageId,pageSize:this.pageSize},function(t,n){t?e(t,null):(o.pageId++,e(null,n))})},c}function o(t){var e=Math.floor(t/36e5),o=Math.floor(t%864e5%36e5/6e4),n=Math.floor(t%864e5%36e5%6e4/1e3);return e=e>9?e:"0"+e,o=o>9?o:"0"+o,n=n>9?n:"0"+n,e+":"+o+":"+n}require.config({baseUrl:"../js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(n,a){"use strict";n.config.delimiters=["${","}"],n.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-product-class",function(e,o,a){var c=new n({el:"#page-product-class",data:{categories:[],search:""}});t("/product/class",{},function(t,e){t?$.toast(t,1e3):c.categories=e.category.slice()}),$(a).on("click",".icon-clear",function(){c.search=""})}),$(document).on("pageInit","#page-product-detail",function(e,o,c){var i=a.getSearch(location);if(!i.id)return void(location.pathname="/");var u=new n({el:"#page-product-detail",data:{isLike:!1,cartNum:3,product:null,style:[],skuImg:[]},computed:{liked:function(){return this.isLike?"已收藏":"收藏"}}});t("/product/detail",{productId:parseInt(i.id)},function(t,e){if(t)$.toast(t,1e3);else{u.product=a.clone(e.product);for(var o=u.product.Skus,n=0;n<o.length;n++)u.style.push(o[n].SizeName),o[n].Images.length>0&&u.skuImg.push(o[n].Images[0].ImgUrl)}}),$(c).on("click",".like",function(){t(u.isLike?"/users/del-fav":"/users/add-fav",{productId:parseInt(i.id)},function(t,e){t?$.toast(t,1e3):($.hidePreloader(),u.isLike=!u.isLike)}),u.isLike?$.showPreloader("取消收藏..."):$.showPreloader("收藏...")}),$(c).on("click",".my-back-top",function(){$(".content").scrollTop(0)});var r=new n({el:"#popup-cart",data:{addCartNum:1}});r.$watch("addCartNum",function(t,e){""!==t&&(a.isPositiveNum(t)||($.toast("请输入正确的购买数量",500),n.nextTick(function(){r.addCartNum=e})))}),$(document).on("click",".my-a-cart.close-popup",function(t){return""===r.addCartNum?(r.addCartNum=1,$.toast("请输入正确的购买数量",1e3),void t.preventDefault()):(u.cartNum+=parseInt(r.addCartNum),void(r.addCartNum=1))}),$(document).on("click",".icon-close.close-popup",function(){r.addCartNum=1}),$(document).on("click",".em-op-d",function(){r.addCartNum>1&&r.addCartNum--}),$(document).on("click",".em-op-a",function(){r.addCartNum++}),$(document).on("click",".my-ul-spec li",function(){$(".my-ul-spec li").removeClass("my-spec-on"),$(this).addClass("my-spec-on")}),$(function(){$(".swiper-container").swiper({spaceBetween:30,continuous:!0,autoplay:2500,autoplayDisableOnInteraction:!1})})}),$(document).on("pageInit","#page-product-group-detail",function(t,e,o){var c=new n({el:"#page-product-group-detail",data:{isLike:!1,cartNum:3},computed:{liked:function(){return this.isLike?"已收藏":"收藏"}}});$(o).on("click",".like",function(){$(this).toggleClass("icon-like"),$(this).toggleClass("icon-likeactive"),c.isLike=!c.isLike}),$(o).on("click",".my-back-top",function(){$(".content").scrollTop(0)});var i=new n({el:"#popup-cart",data:{addCartNum:1}});i.$watch("addCartNum",function(t,e){""!==t&&(a.isPositiveNum(t)||($.toast("请输入正确的购买数量",500),n.nextTick(function(){i.addCartNum=e})))}),$(document).on("click",".my-a-cart.close-popup",function(){return""===i.addCartNum?(i.addCartNum=1,void $.toast("请输入正确的购买数量",1e3)):(c.cartNum+=parseInt(i.addCartNum),void(i.addCartNum=1))}),$(document).on("click",".icon-close.close-popup",function(){i.addCartNum=1}),$(document).on("click",".em-op-d",function(){i.addCartNum>1&&i.addCartNum--}),$(document).on("click",".em-op-a",function(){i.addCartNum++}),$(document).on("click",".my-ul-spec li",function(){$(".my-ul-spec li").removeClass("my-spec-on"),$(this).addClass("my-spec-on")}),$(function(){$(".swiper-container").swiper({spaceBetween:30,continuous:!0,autoplay:2500,autoplayDisableOnInteraction:!1})})}),$(document).on("pageInit","#page-product-list",function(t,o,c){function i(t){l.product=u.products[t],l.curPrice=l.product.SkuList[0].Price,l.curImg=l.product.SkuList[0].Images[0].ImgUrl,$.popup(".popup-cart")}var u=new n({el:"#page-product-list",data:{search:"",products:[],count:0,cartNum:30},methods:{addToCart:i}}),r=void 0,d=!1;if("/product/sales"===location.pathname)r=new e("/product/sales",10),r.addItems(function(t,e){t?$.toast(t,1e3):(u.count=e.count,u.products=u.products.concat(e.products))});else if("/product/new"===location.pathname)r=new e("/product/new",10),r.addItems(function(t,e){t?$.toast(t,1e3):(u.count=e.count,u.products=u.products.concat(e.products))});else if("/product/group"===location.pathname);else if("/product/recommend"===location.pathname);else if("/product/category"===location.pathname){var s=a.getSearch(location);if(!s.CId||!s.ChildCId)return void(location.pathname="/");r=new e("/product/category",10,parseInt(s.CId),parseInt(s.ChildCId)),r.addItems(function(t,e){t?$.toast(t,1e3):(u.count=e.count,u.products=u.products.concat(e.products))})}$(c).on("infinite",".infinite-scroll-bottom",function(){d||(d=!0,setTimeout(function(){return d=!1,u.products.length>=u.count?($.detachInfiniteScroll($(".infinite-scroll")),void $(".infinite-scroll-preloader").remove()):(r.addItems(function(t,e){t?$.toast(t,1e3):(u.count=e.count,u.products=u.products.concat(e.products))}),void $.refreshScroller())},1e3))}),$(c).on("click",".icon-clear",function(){u.search=""});var l=new n({el:"#popup-cart",data:{addCartNum:1,product:null,curPrice:0,curImg:""}});l.$watch("addCartNum",function(t,e){""!==t&&(a.isPositiveNum(t)||($.toast("请输入正确的购买数量",500),n.nextTick(function(){l.addCartNum=e})))}),$(document).on("click",".my-a-cart.close-popup",function(t){return t.preventDefault(),""===l.addCartNum?(l.addCartNum=1,void $.toast("请输入正确的购买数量",1e3)):(u.cartNum+=parseInt(l.addCartNum),l.addCartNum=1,void(l.product=null))}),$(document).on("click",".icon-close.close-popup",function(){event.preventDefault(),l.addCartNum=1,l.product=null}),$(document).on("click",".em-op-d",function(){l.addCartNum>1&&l.addCartNum--}),$(document).on("click",".em-op-a",function(){l.addCartNum++}),$(document).on("click",".my-ul-spec li",function(){$(".my-ul-spec li").removeClass("my-spec-on"),$(this).addClass("my-spec-on");var t=$(this).val(),e=l.product.SkuList[t];l.curPrice=e.Price,l.curImg=e.Images[0].ImgUrl})}),$(document).on("pageInit","#page-product-flash-deal-list",function(t,a,c){function i(t){if(t.RemainStartTotalSeconds>0)t.RemainStartTotalSeconds-=1e3,t.remainStart=o(t.RemainStartTotalSeconds);else{t.killStatus=1;var e=new Date(t.EndTime).getTime(),n=(new Date).getTime();t.RemainEndTotalSeconds=e-n}}function u(t){t.RemainEndTotalSeconds>0?(t.RemainEndTotalSeconds-=1e3,t.remainEnd=o(t.RemainEndTotalSeconds)):t.killStatus=0}var r=new n({el:"#page-product-flash-deal-list",data:{search:"",count:0,products:[]}}),d=new e("/product/secKill",10);d.addItems(function(t,e){if(t)$.toast(t,1e3);else{r.count=e.count;for(var n=e.products,a=n.length,c=null,i=0;a>i;i++)c=n[i],c.RemainStartTotalSeconds=1e3*parseInt(c.RemainStartTotalSeconds),c.RemainEndTotalSeconds=1e3*parseInt(c.RemainEndTotalSeconds),c.RemainEndTotalSeconds>0?(c.killStatus=1,c.remainEnd=o(c.RemainEndTotalSeconds)):c.RemainStartTotalSeconds>0?(c.killStatus=2,c.remainStart=o(c.RemainStartTotalSeconds)):c.killStatus=0;r.products=r.products.concat(e.products)}}),setInterval(function(){for(var t=r.products,e=t.length,o=null,n=0;e>n;n++)if(o=t[n],1===o.killStatus)u(o);else{if(2!==o.killStatus)continue;i(o)}},1e3),$(c).on("click",".icon-clear",function(){r.search=""})}),$.init()})}();