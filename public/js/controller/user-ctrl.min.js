!function(){function e(e,t,o){$.ajax({type:"POST",url:e,data:t,timeout:15e3,success:function(e,t,n){e.status?o(null,e):o(e.msg,null)},error:function(t,n,a){console.error(e+" error: "+n+"##"+a),o("服务异常",null)}})}function t(t){e("/users/getStoreName",{},function(e,o){t(e,o.storeName)})}function o(t,o){var n={};return n.url=t,n.pageSize=o,n.pageId=0,n.addItems=function(t){var o=this;e(this.url,{pageId:this.pageId,pageSize:this.pageSize},function(e,n){e?t(e,null):(o.pageId++,t(null,n))})},n}function n(t,o,n,a){var r={};return r.url=t,r.pageSize=o,r.pageId=0,r.type=n,r.orderStatus=a,r.addItems=function(t){var o=this;e(this.url,{pageId:this.pageId,pageSize:this.pageSize,type:this.type,orderStatus:this.orderStatus},function(e,n){e?t(e,null):(o.pageId++,t(null,n))})},r}require.config({baseUrl:"../js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(a,r){"use strict";a.config.delimiters=["${","}"],a.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-my",function(o,n,r){var s=new a({el:"#page-my",data:{storeName:"",message:0}});t(function(e,t){e?$.toast(e,1e3):s.storeName=t}),e("/users/get-notice-count",{},function(e,t){e||(s.message=t.count)})}),$(document).on("pageInit","#page-my-account",function(e,o,n){var r=new a({el:"#page-my-account",data:{storeName:""}});t(function(e,t){e?$.toast(e,1e3):r.storeName=t}),$(n).on("click","#linkName",function(){location.href="/users/change-shop-name"}),$(n).on("click","#linkAddress",function(){location.href="/users/my-address"}),$(n).on("click","#linkPassword",function(){location.href="/users/change-password"})}),$(document).on("pageInit","#page-change-shop-name",function(o,n,r){function s(t){e("/users/setStoreName",{storeName:i.storeName},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):location.href="/users/account"}),$.showPreloader("保存中")}var i=new a({el:"#page-change-shop-name",data:{storeName:""},methods:{setStoreName:s}});t(function(e,t){e?$.toast(e,1e3):i.storeName=t})}),$(document).on("pageInit","#page-change-password",function(t,o,n){function r(t){if(!s.isDisable){if(s.newPW!=s.rePW)return void $.toast("密码输入不一致");e("/users/change-password",{password:s.newPW},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):($.toast("新密码设置成功！",1e3),location.href="/users/account")}),$.showPreloader("保存中")}}var s=new a({el:"#page-change-password",data:{oldPW:"",newPW:"",rePW:""},computed:{isDisable:function(){return 0===this.oldPW.length||0===this.newPW.length||0===this.rePW.length}},method:{changePW:r}})}),$(document).on("pageInit","#page-my-buy-report",function(e,t,o){var n=r.dateFormat(new Date,"yyyy-MM-dd"),s=new a({el:"#page-my-buy-report",data:{start:n,end:n}});$(o).on("click",".button",function(){$.router.load("/users/buy-report-result")}),$("#my-start-time").calendar({value:[s.start]}),$("#my-end-time").calendar({value:[s.end]})}),$(document).on("pageInit","#page-my-buy-report-result",function(e,t,o){new a({el:"#page-my-buy-report-result",data:{}})}),$(document).on("pageInit","#page-my-fav",function(t,n,s){function i(){e("/cart/get-count-in-cart",{},function(e,t){e||(l.cartNum=t.count)})}function c(){return""===f.addCartNum?(f.addCartNum=1,void $.toast("请输入正确的购买数量",1e3)):(e("/cart/add-to-cart",{productId:f.product.SysNo,skuId:f.curSkuId,qty:f.addCartNum},function(e,t){e?$.toast(e,1e3):i()}),f.addCartNum=1,void(f.product=null))}function u(e){f.product=l.favList[e],f.curSkuId=f.product.SkuList[0].SysNo,f.curPrice=f.product.SkuList[0].Price,f.curImg=f.product.SkuList[0].Images[0].ImgUrl,$.popup(".popup-cart")}function d(t){var o=l.favList[t];e(o.isLike?"/users/del-fav":"/users/add-fav",{productId:o.SysNo},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):o.isLike=!o.isLike}),l.isLike?$.showPreloader("取消收藏..."):$.showPreloader("收藏...")}var l=new a({el:"#page-my-fav",data:{search:"",cartNum:0,favList:[],count:0},methods:{addToFav:d,OpenCart:u}}),f=new a({el:"#popup-cart",data:{addCartNum:1,product:null,curPrice:0,curImg:"",curSkuId:0},methods:{addToCart:c}});i();var m=!1,p=new o("/users/my-fav",10);p.addItems(function(e,t){e?$.toast(e,1e3):(l.count=t.count,l.favList=l.favList.concat(t.favorite))}),$(s).on("infinite",".infinite-scroll-bottom",function(){m||(m=!0,setTimeout(function(){return m=!1,l.favList.length>=l.count?($.detachInfiniteScroll($(".infinite-scroll")),void $(".infinite-scroll-preloader").remove()):(p.addItems(function(e,t){e?$.toast(e,1e3):(l.count=t.count,l.favList=l.favList.concat(t.favorite))}),void $.refreshScroller())},1e3))}),$(s).on("click",".icon-clear",function(){l.search=""}),f.$watch("addCartNum",function(e,t){""!==e&&(r.isPositiveNum(e)||($.toast("请输入正确的购买数量",500),a.nextTick(function(){f.addCartNum=t})))}),$(document).on("click",".icon-close.close-popup",function(){f.addCartNum=1,f.product=null}),$(document).on("click",".em-op-d",function(){f.addCartNum>1&&f.addCartNum--}),$(document).on("click",".em-op-a",function(){f.addCartNum++}),$(document).on("click",".my-ul-spec li",function(){$(".my-ul-spec li").removeClass("my-spec-on"),$(this).addClass("my-spec-on");var e=$(this).val(),t=f.product.SkuList[e];f.curSkuId=t.SysNo,f.curPrice=t.Price,f.curImg=t.Images[0].ImgUrl})}),$(document).on("pageInit","#page-my-message",function(t,n,r){function s(t){var o=i.notices[t];e("/users/set-notice-status",{noticeId:o.NoticeSysno},function(e,t){e||(o.IfRead=!0)}),$.modal({title:o.NoticeTitle+'<span class="my-message-time">'+o.InDate+"</span>",text:"<p>"+o.NoticeContext+"<p>",extraClass:"my-dialog",buttons:[{text:'<a href="#" class="icon icon-close my-black-text"></a>'}]})}var i=new a({el:"#page-my-message",data:{notices:[]},methods:{openMsg:s}}),c=!1,u=new o("/users/my-message",20);u.addItems(function(e,t){e?$.toast(e,1e3):(i.count=t.count,i.notices=i.notices.concat(t.notices))}),$(r).on("infinite",".infinite-scroll-bottom",function(){c||(c=!0,setTimeout(function(){return c=!1,i.notices.length>=i.count?($.detachInfiniteScroll($(".infinite-scroll")),void $(".infinite-scroll-preloader").remove()):(u.addItems(function(e,t){e?$.toast(e,1e3):(i.count=t.count,i.notices=i.notices.concat(t.notices))}),void $.refreshScroller())},1e3))})}),$(document).on("pageInit","#page-my-address",function(t,o,n){function r(t,o){$.confirm("确定删除该地址吗?",function(){e("/address/del-receiver",{receiverId:s.receivers[t].receiverId},function(e,o){e?$.toast(e,1e3):s.receivers.splice(t,1)})},function(){})}var s=new a({el:"#page-my-address",data:{receivers:[],defaultIdx:null},methods:{deleteAdr:r}});e("/address/get-all-receiver",{},function(e,t){if(e)$.toast(e,1e3);else for(var o=t.receiver,n=o.length,a=0;n>a;a++){var r={};r.receiverId=o[a].SysNo,r.phone=o[a].ReceiverPhone,r.receiver=o[a].ReceiverName,r.pcdDes=o[a].Province+" "+o[a].City+" "+o[a].District,r.address=o[a].Address,r.isDefault=o[a].IsDefault,s.receivers.push(r)}}),$(n).on("change",'[name="single-radio"]',function(){e("/address/set-default-receiver",{receiverId:s.receivers[s.defaultIdx].receiverId},function(e,t){if($.hidePreloader(),e)$.toast(e,1e3);else for(var o=s.receivers.length,n=0;o>n;n++)n===s.defaultIdx?s.receivers[n].isDefault=!0:s.receivers[n].isDefault=!1}),$.showPreloader("保存中")})}),$(document).on("pageInit","#page-my-account",function(e,o,n){var r=new a({el:"#page-my-account",data:{storeName:""}});t(function(e,t){e?$.toast(e,1e3):r.storeName=t}),$(n).on("click","#linkName",function(){location.href="/users/change-shop-name"}),$(n).on("click","#linkAddress",function(){location.href="/users/my-address"}),$(n).on("click","#linkPassword",function(){location.href="/users/change-password"})}),$(document).on("pageInit","#page-my-book",function(e,t,o){function r(e){var t=0,o=null;for(t=0;t<e.orders.length;t++)o=e.orders[t],o.statusNote="",o.canCancel=!1,o.canPay=!1,o.reBuy=!1,"待审核"===o.Status||"待付款"===o.Status?"货到付款"===!o.PayMent&&0===o.PaymentStatus?(o.statusNote="待付款",o.canCancel=!0,o.canPay=!0):(o.statusNote="待审核",o.canCancel=!0):"待发货"===o.Status||"已发货"===o.Status?o.statusNote=o.Status:(o.statusNote=o.Status,o.reBuy=!0)}var s=new a({el:"#page-my-book",data:{orderListNow:[],orderListAgo:[],countNow:0,countAgo:0},methods:{}}),i=!1,c=new n("/users/my-book",10,0,0),u=new n("/users/my-book",10,1,0);c.addItems(function(e,t){$.hidePreloader(),e?$.toast(e,1e3):(s.countNow=t.count,r(t),s.orderListNow=s.orderListNow.concat(t.orders))}),u.addItems(function(e,t){e?$.toast(e,1e3):(s.countAgo=t.count,r(t),s.orderListAgo=s.orderListAgo.concat(t.orders))}),$.showPreloader("请稍等"),$(o).on("infinite",function(){if(!i){i=!0;var e=0;"tab1"==$(this).find(".infinite-scroll.active").attr("id")&&(e=0),"tab2"==$(this).find(".infinite-scroll.active").attr("id")&&(e=1),setTimeout(function(){return i=!1,s.orderListNow.length>=s.countNow?void $(".infinite-scroll-preloader").eq(e).hide():(0===e?c.addItems(function(e,t){e?$.toast(e,1e3):(s.countNow=t.count,r(t),s.orderListNow=s.orderListNow.concat(t.orders))}):u.addItems(function(e,t){e?$.toast(e,1e3):(s.countAgo=t.count,r(t),s.orderListAgo=s.orderListAgo.concat(t.orders))}),void $.refreshScroller())},1e3)}})}),$.init()})}();