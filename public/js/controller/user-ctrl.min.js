!function(){function e(e,t,n){$.ajax({type:"POST",url:e,data:t,timeout:15e3,success:function(e,t,o){e.status?n(null,e):n(e.msg,null)},error:function(t,o,a){console.error(e+" error: "+o+"##"+a),n("服务异常",null)}})}function t(t){e("/users/getStoreName",{},function(e,n){t(e,n.storeName)})}function n(t,n){var o={};return o.url=t,o.pageSize=n,o.pageId=0,o.addItems=function(t){var n=this;e(this.url,{pageId:this.pageId,pageSize:this.pageSize},function(e,o){e?t(e,null):(n.pageId++,t(null,o))})},o}require.config({baseUrl:"../js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(o,a){"use strict";o.config.delimiters=["${","}"],o.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-my",function(e,n,a){var i=new o({el:"#page-my",data:{storeName:""}});t(function(e,t){e?$.toast(e,1e3):i.storeName=t})}),$(document).on("pageInit","#page-my-account",function(e,n,a){var i=new o({el:"#page-my-account",data:{storeName:""}});t(function(e,t){e?$.toast(e,1e3):i.storeName=t}),$(a).on("click","#linkName",function(){location.href="/users/change-shop-name"}),$(a).on("click","#linkAddress",function(){location.href="/users/my-address"}),$(a).on("click","#linkPassword",function(){location.href="/users/change-password"})}),$(document).on("pageInit","#page-change-shop-name",function(n,a,i){function r(t){e("/users/setStoreName",{storeName:s.storeName},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):location.href="/users/account"}),$.showPreloader("保存中")}var s=new o({el:"#page-change-shop-name",data:{storeName:""},methods:{setStoreName:r}});t(function(e,t){e?$.toast(e,1e3):s.storeName=t})}),$(document).on("pageInit","#page-change-password",function(t,n,a){function i(t){if(!r.isDisable){if(r.newPW!=r.rePW)return void $.toast("密码输入不一致");e("/users/change-password",{password:r.newPW},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):($.toast("新密码设置成功！",1e3),location.href="/users/account")}),$.showPreloader("保存中")}}var r=new o({el:"#page-change-password",data:{oldPW:"",newPW:"",rePW:""},computed:{isDisable:function(){return 0===this.oldPW.length||0===this.newPW.length||0===this.rePW.length}},method:{changePW:i}})}),$(document).on("pageInit","#page-my-buy-report",function(e,t,n){var i=a.dateFormat(new Date,"yyyy-MM-dd"),r=new o({el:"#page-my-buy-report",data:{start:i,end:i}});$(n).on("click",".button",function(){$.router.load("/users/buy-report-result")}),$("#my-start-time").calendar({value:[r.start]}),$("#my-end-time").calendar({value:[r.end]})}),$(document).on("pageInit","#page-my-buy-report-result",function(e,t,n){new o({el:"#page-my-buy-report-result",data:{}})}),$(document).on("pageInit","#page-my-fav",function(t,i,r){function s(e){d.product=u.favList[e],d.curPrice=d.product.SkuList[0].Price,d.curImg=d.product.SkuList[0].Images[0].ImgUrl,$.popup(".popup-cart")}function c(t){var n=u.favList[t];e(n.isLike?"/users/del-fav":"/users/add-fav",{productId:n.SysNo},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):n.isLike=!n.isLike}),u.isLike?$.showPreloader("取消收藏..."):$.showPreloader("收藏...")}var u=new o({el:"#page-my-fav",data:{search:"",cartNum:30,favList:[],count:0},methods:{addToFav:c,addToCart:s}}),d=new o({el:"#popup-cart",data:{addCartNum:1,product:null,curPrice:0,curImg:""}}),l=!1,m=new n("/users/my-fav",10);m.addItems(function(e,t){e?$.toast(e,1e3):(u.count=t.count,u.favList=u.favList.concat(t.favorite))}),$(r).on("infinite",".infinite-scroll-bottom",function(){l||(l=!0,setTimeout(function(){return l=!1,u.favList.length>=u.count?($.detachInfiniteScroll($(".infinite-scroll")),void $(".infinite-scroll-preloader").remove()):(m.addItems(function(e,t){e?$.toast(e,1e3):(u.count=t.count,u.favList=u.favList.concat(t.favorite))}),void $.refreshScroller())},1e3))}),$(r).on("click",".icon-clear",function(){u.search=""}),d.$watch("addCartNum",function(e,t){""!==e&&(a.isPositiveNum(e)||($.toast("请输入正确的购买数量",500),o.nextTick(function(){d.addCartNum=t})))}),$(document).on("click",".my-a-cart.close-popup",function(){return""===d.addCartNum?(d.addCartNum=1,$.toast("请输入正确的购买数量",1e3),void t.preventDefault()):(u.cartNum+=parseInt(d.addCartNum),d.addCartNum=1,void(d.product=null))}),$(document).on("click",".icon-close.close-popup",function(){d.addCartNum=1,d.product=null}),$(document).on("click",".em-op-d",function(){d.addCartNum>1&&d.addCartNum--}),$(document).on("click",".em-op-a",function(){d.addCartNum++}),$(document).on("click",".my-ul-spec li",function(){$(".my-ul-spec li").removeClass("my-spec-on"),$(this).addClass("my-spec-on");var e=$(this).val(),t=d.product.SkuList[e];d.curPrice=t.Price,d.curImg=t.Images[0].ImgUrl})}),$(document).on("pageInit","#page-my-message",function(t,a,i){function r(t){var n=s.notices[t];e("/users/set-notice-status",{noticeId:n.NoticeSysno},function(e,t){e||(n.IfRead=!0)}),$.modal({title:n.NoticeTitle+'<span class="my-message-time">'+n.InDate+"</span>",text:"<p>"+n.NoticeContext+"<p>",extraClass:"my-dialog",buttons:[{text:'<a href="#" class="icon icon-close my-black-text"></a>'}]})}var s=new o({el:"#page-my-message",data:{notices:[]},methods:{openMsg:r}}),c=!1,u=new n("/users/my-message",20);u.addItems(function(e,t){e?$.toast(e,1e3):(s.count=t.count,s.notices=s.notices.concat(t.notices))}),$(i).on("infinite",".infinite-scroll-bottom",function(){c||(c=!0,setTimeout(function(){return c=!1,s.notices.length>=s.count?($.detachInfiniteScroll($(".infinite-scroll")),void $(".infinite-scroll-preloader").remove()):(u.addItems(function(e,t){e?$.toast(e,1e3):(s.count=t.count,s.notices=s.notices.concat(t.notices))}),void $.refreshScroller())},1e3))})}),$(document).on("pageInit","#page-my-address",function(t,n,a){function i(t,n){$.confirm("确定删除该地址吗?",function(){e("/address/del-receiver",{receiverId:r.receivers[t].receiverId},function(e,n){e?$.toast(e,1e3):r.receivers.splice(t,1)})},function(){})}var r=new o({el:"#page-my-address",data:{receivers:[],defaultIdx:null},methods:{deleteAdr:i}});e("/address/get-all-receiver",{},function(e,t){if(e)$.toast(e,1e3);else for(var n=t.receiver,o=n.length,a=0;o>a;a++){var i={};i.receiverId=n[a].SysNo,i.phone=n[a].ReceiverPhone,i.receiver=n[a].ReceiverName,i.pcdDes=n[a].Province+" "+n[a].City+" "+n[a].District,i.address=n[a].Address,i.isDefault=n[a].IsDefault,r.receivers.push(i)}}),$(a).on("change",'[name="single-radio"]',function(){e("/address/set-default-receiver",{receiverId:r.receivers[r.defaultIdx].receiverId},function(e,t){if($.hidePreloader(),e)$.toast(e,1e3);else for(var n=r.receivers.length,o=0;n>o;o++)o===r.defaultIdx?r.receivers[o].isDefault=!0:r.receivers[o].isDefault=!1}),$.showPreloader("保存中")})}),$.init()})}();