!function(){function e(e,t,o){$.ajax({type:"POST",url:e,data:t,timeout:15e3,success:function(e,t,n){e.status?o(null,e):o(e.msg,null)},error:function(t,n,r){console.error(e+" error: "+n+"##"+r),o("服务异常",null)}})}function t(t){e("/users/getStoreName",{},function(e,o){t(e,o.storeName)})}function o(t,o){var n={};return n.url=t,n.pageSize=o,n.pageId=0,n.addItems=function(t){var o=this;e(this.url,{pageId:this.pageId,pageSize:this.pageSize},function(e,n){e?t(e,null):(o.pageId++,t(null,n))})},n}function n(t,o,n,r){var i={};return i.url=t,i.pageSize=o,i.pageId=0,i.type=n,i.orderStatus=r,i.addItems=function(t){var o=this;e(this.url,{pageId:this.pageId,pageSize:this.pageSize,type:this.type,orderStatus:this.orderStatus},function(e,n){e?t(e,null):(o.pageId++,t(null,n))})},i}require.config({baseUrl:"../js",paths:{Vue:"./lib/vue.min",Utils:"./lib/utils"},shim:{Vue:{exports:"Vue"},Utils:{exports:"Utils"}}}),require(["Vue","Utils"],function(r,i){"use strict";r.config.delimiters=["${","}"],r.config.unsafeDelimiters=["{!!","!!}"],$(document).on("pageInit","#page-my",function(o,n,i){var a=new r({el:"#page-my",data:{storeName:"",message:0}});t(function(e,t){e?$.toast(e,1e3):a.storeName=t}),e("/users/get-notice-count",{},function(e,t){e||(a.message=t.count)})}),$(document).on("pageInit","#page-my-account",function(e,o,n){var i=new r({el:"#page-my-account",data:{storeName:""}});t(function(e,t){e?$.toast(e,1e3):i.storeName=t}),$(n).on("click","#linkName",function(){location.href="/users/change-shop-name"}),$(n).on("click","#linkAddress",function(){location.href="/users/my-address"}),$(n).on("click","#linkPassword",function(){location.href="/users/change-password"})}),$(document).on("pageInit","#page-change-shop-name",function(o,n,i){function a(t){e("/users/setStoreName",{storeName:c.storeName},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):location.href="/users/account"}),$.showPreloader("保存中")}var c=new r({el:"#page-change-shop-name",data:{storeName:""},methods:{setStoreName:a}});t(function(e,t){e?$.toast(e,1e3):c.storeName=t})}),$(document).on("pageInit","#page-change-password",function(t,o,n){function i(t){if(!a.isDisable){if(a.newPW!=a.rePW)return void $.toast("密码输入不一致");e("/users/change-password",{password:a.newPW},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):($.toast("新密码设置成功！",1e3),location.href="/users/account")}),$.showPreloader("保存中")}}var a=new r({el:"#page-change-password",data:{oldPW:"",newPW:"",rePW:""},computed:{isDisable:function(){return 0===this.oldPW.length||0===this.newPW.length||0===this.rePW.length}},method:{changePW:i}})}),$(document).on("pageInit","#page-my-buy-report",function(e,t,o){var n=i.dateFormat(new Date,"yyyy-MM-dd"),a=new r({el:"#page-my-buy-report",data:{start:n,end:n}});$(o).on("click",".button",function(){$.router.load("/users/buy-report-result")}),$("#my-start-time").calendar({value:[a.start]}),$("#my-end-time").calendar({value:[a.end]})}),$(document).on("pageInit","#page-my-buy-report-result",function(e,t,o){new r({el:"#page-my-buy-report-result",data:{}})}),$(document).on("pageInit","#page-my-fav",function(t,n,a){function c(){e("/cart/get-count-in-cart",{},function(e,t){e||(l.cartNum=t.count)})}function s(){return""===m.addCartNum?(m.addCartNum=1,void $.toast("请输入正确的购买数量",1e3)):(e("/cart/add-to-cart",{productId:m.product.SysNo,skuId:m.curSkuId,qty:m.addCartNum},function(e,t){e?$.toast(e,1e3):c()}),m.addCartNum=1,void(m.product=null))}function u(e){m.product=l.favList[e],m.curSkuId=m.product.SkuList[0].SysNo,m.curPrice=m.product.SkuList[0].Price,m.curImg=m.product.SkuList[0].Images[0].ImgUrl,$.popup(".popup-cart")}function d(t){var o=l.favList[t];e(o.isLike?"/users/del-fav":"/users/add-fav",{productId:o.SysNo},function(e,t){$.hidePreloader(),e?$.toast(e,1e3):o.isLike=!o.isLike}),l.isLike?$.showPreloader("取消收藏..."):$.showPreloader("收藏...")}var l=new r({el:"#page-my-fav",data:{search:"",cartNum:0,favList:[],count:0},methods:{addToFav:d,OpenCart:u}}),m=new r({el:"#popup-cart",data:{addCartNum:1,product:null,curPrice:0,curImg:"",curSkuId:0},methods:{addToCart:s}});c();var f=!1,p=new o("/users/my-fav",10);p.addItems(function(e,t){e?$.toast(e,1e3):(l.count=t.count,l.favList=l.favList.concat(t.favorite))}),$(a).on("infinite",".infinite-scroll-bottom",function(){f||(f=!0,setTimeout(function(){return f=!1,l.favList.length>=l.count?($.detachInfiniteScroll($(".infinite-scroll")),void $(".infinite-scroll-preloader").remove()):(p.addItems(function(e,t){e?$.toast(e,1e3):(l.count=t.count,l.favList=l.favList.concat(t.favorite))}),void $.refreshScroller())},1e3))}),$(a).on("click",".icon-clear",function(){l.search=""}),m.$watch("addCartNum",function(e,t){""!==e&&(i.isPositiveNum(e)||($.toast("请输入正确的购买数量",500),r.nextTick(function(){m.addCartNum=t})))}),$(document).on("click",".icon-close.close-popup",function(){m.addCartNum=1,m.product=null}),$(document).on("click",".em-op-d",function(){m.addCartNum>1&&m.addCartNum--}),$(document).on("click",".em-op-a",function(){m.addCartNum++}),$(document).on("click",".my-ul-spec li",function(){$(".my-ul-spec li").removeClass("my-spec-on"),$(this).addClass("my-spec-on");var e=$(this).val(),t=m.product.SkuList[e];m.curSkuId=t.SysNo,m.curPrice=t.Price,m.curImg=t.Images[0].ImgUrl})}),$(document).on("pageInit","#page-my-message",function(t,n,i){function a(t){var o=c.notices[t];e("/users/set-notice-status",{noticeId:o.NoticeSysno},function(e,t){e||(o.IfRead=!0)}),$.modal({title:o.NoticeTitle+'<span class="my-message-time">'+o.InDate+"</span>",text:"<p>"+o.NoticeContext+"<p>",extraClass:"my-dialog",buttons:[{text:'<a href="#" class="icon icon-close my-black-text"></a>'}]})}var c=new r({el:"#page-my-message",data:{notices:[]},methods:{openMsg:a}}),s=!1,u=new o("/users/my-message",20);u.addItems(function(e,t){e?$.toast(e,1e3):(c.count=t.count,c.notices=c.notices.concat(t.notices))}),$(i).on("infinite",".infinite-scroll-bottom",function(){s||(s=!0,setTimeout(function(){return s=!1,c.notices.length>=c.count?($.detachInfiniteScroll($(".infinite-scroll")),void $(".infinite-scroll-preloader").remove()):(u.addItems(function(e,t){e?$.toast(e,1e3):(c.count=t.count,c.notices=c.notices.concat(t.notices))}),void $.refreshScroller())},1e3))})}),$(document).on("pageInit","#page-my-address",function(t,o,n){function i(t,o){$.confirm("确定删除该地址吗?",function(){e("/address/del-receiver",{receiverId:a.receivers[t].receiverId},function(e,o){e?$.toast(e,1e3):a.receivers.splice(t,1)})},function(){})}var a=new r({el:"#page-my-address",data:{receivers:[],defaultIdx:null},methods:{deleteAdr:i}});e("/address/get-all-receiver",{},function(e,t){if(e)$.toast(e,1e3);else for(var o=t.receiver,n=o.length,r=0;n>r;r++){var i={};i.receiverId=o[r].SysNo,i.phone=o[r].ReceiverPhone,i.receiver=o[r].ReceiverName,i.pcdDes=o[r].Province+" "+o[r].City+" "+o[r].District,i.address=o[r].Address,i.isDefault=o[r].IsDefault,a.receivers.push(i)}}),$(n).on("change",'[name="single-radio"]',function(){e("/address/set-default-receiver",{receiverId:a.receivers[a.defaultIdx].receiverId},function(e,t){if($.hidePreloader(),e)$.toast(e,1e3);else for(var o=a.receivers.length,n=0;o>n;n++)n===a.defaultIdx?a.receivers[n].isDefault=!0:a.receivers[n].isDefault=!1}),$.showPreloader("保存中")})}),$(document).on("pageInit","#page-my-account",function(e,o,n){var i=new r({el:"#page-my-account",data:{storeName:""}});t(function(e,t){e?$.toast(e,1e3):i.storeName=t}),$(n).on("click","#linkName",function(){location.href="/users/change-shop-name"}),$(n).on("click","#linkAddress",function(){location.href="/users/my-address"}),$(n).on("click","#linkPassword",function(){location.href="/users/change-password"})}),$(document).on("pageInit","#page-my-book",function(e,t,o){var i=new r({el:"#page-my-book",data:{orderListNow:[],orderListAgo:[],countNow:0,countAgo:0},methods:{}}),a=!1,c=!1,s=new n("/users/my-book",10,0),u=new n("/users/my-book",10,1);s.addItems(function(e,t){$.hidePreloader(),e?$.toast(e,1e3):(i.countNow=t.count,i.orderListNow=i.orderListNow.concat(t.orders))}),u.addItems(function(e,t){e?$.toast(e,1e3):(i.countAgo=t.count,i.orderListAgo=i.orderListAgo.concat(t.orders))}),$.showPreloader("请稍等"),$(o).on("infinite",".in-month.infinite-scroll-bottomm",function(){a||(a=!0,setTimeout(function(){return a=!1,i.orderListNow.length>=i.countNow?($.detachInfiniteScroll($(".in-month.infinite-scroll")),void $(".in-month.infinite-scroll-preloader").remove()):(s.addItems(function(e,t){e?$.toast(e,1e3):(i.countNow=t.count,i.orderListNow=i.orderListNow.concat(t.order))}),void $.refreshScroller())},1e3))}),$(o).on("infinite",".month-ago.infinite-scroll-bottomm",function(){c||(c=!0,setTimeout(function(){return c=!1,i.orderListAgo.length>=i.countAgo?($.detachInfiniteScroll($(".month-ago.infinite-scroll")),void $(".month-ago.infinite-scroll-preloader").remove()):(u.addItems(function(e,t){e?$.toast(e,1e3):(i.countAgo=t.count,i.orderListAgo=i.orderListAgo.concat(t.order))}),void $.refreshScroller())},1e3))})}),$.init()})}();